version: '3.9'

services:
  # ============================================
  # Web Client - React App (Production build)
  # ============================================
  web-client-prod:
    build:
      context: .
      dockerfile: Dockerfile.gcp
    container_name: carelink-web-client-prod
    ports:
      - "8080:8080"
    environment:
      - REACT_APP_API_URL=http://api:1337
      - REACT_APP_NAME=CareLink
      - REACT_APP_VERSION=1.0.0
    healthcheck:
      test: ["CMD", "wget", "--quiet", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    restart: unless-stopped
    networks:
      - carelink-network
    labels:
      - "app=carelink"
      - "component=web-client"
      - "environment=production"

  # ============================================
  # Web Client - Development (Hot reload)
  # ============================================
  web-client-dev:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: carelink-web-client-dev
    ports:
      - "3000:3000"
    environment:
      - REACT_APP_API_URL=http://localhost:1337
      - REACT_APP_NAME=CareLink Dev
      - REACT_APP_VERSION=1.0.0-dev
      - WATCHPACK_POLLING=true
    volumes:
      - ./src:/app/src
      - ./public:/app/public
      - /app/node_modules
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:3000"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    restart: unless-stopped
    networks:
      - carelink-network
    labels:
      - "app=carelink"
      - "component=web-client"
      - "environment=development"
    profiles:
      - dev

networks:
  carelink-network:
    name: carelink-network
    driver: bridge

# ============================================
# Usage:
# ============================================
# 
# Production build (GCP-like):
#   docker-compose up web-client-prod
# 
# Development with hot reload:
#   docker-compose --profile dev up web-client-dev
# 
# Build only (don't run):
#   docker-compose build web-client-prod
# 
# View logs:
#   docker-compose logs -f web-client-prod
# 
# Stop services:
#   docker-compose down
# 
# Remove volumes:
#   docker-compose down -v
# 
# Rebuild without cache:
#   docker-compose build --no-cache web-client-prod
